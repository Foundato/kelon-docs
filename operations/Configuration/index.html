



<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.0.4, mkdocs-material-4.6.2">
    
    
      
        <title>Configuration - Kelon Docs</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/application.adb8469c.css">
      
      
    
    
      <script src="../../assets/javascripts/modernizr.86422ebf.js"></script>
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono","Courier New",Courier,monospace}</style>
      
    
    <link rel="stylesheet" href="../../assets/fonts/material-icons.css">
    
    
    
      
    
    
  </head>
  
    <body dir="ltr">
  
    <svg class="md-svg">
      <defs>
        
        
          <svg xmlns="http://www.w3.org/2000/svg" width="416" height="448" viewBox="0 0 416 448" id="__github"><path fill="currentColor" d="M160 304q0 10-3.125 20.5t-10.75 19T128 352t-18.125-8.5-10.75-19T96 304t3.125-20.5 10.75-19T128 256t18.125 8.5 10.75 19T160 304zm160 0q0 10-3.125 20.5t-10.75 19T288 352t-18.125-8.5-10.75-19T256 304t3.125-20.5 10.75-19T288 256t18.125 8.5 10.75 19T320 304zm40 0q0-30-17.25-51T296 232q-10.25 0-48.75 5.25Q229.5 240 208 240t-39.25-2.75Q130.75 232 120 232q-29.5 0-46.75 21T56 304q0 22 8 38.375t20.25 25.75 30.5 15 35 7.375 37.25 1.75h42q20.5 0 37.25-1.75t35-7.375 30.5-15 20.25-25.75T360 304zm56-44q0 51.75-15.25 82.75-9.5 19.25-26.375 33.25t-35.25 21.5-42.5 11.875-42.875 5.5T212 416q-19.5 0-35.5-.75t-36.875-3.125-38.125-7.5-34.25-12.875T37 371.5t-21.5-28.75Q0 312 0 260q0-59.25 34-99-6.75-20.5-6.75-42.5 0-29 12.75-54.5 27 0 47.5 9.875t47.25 30.875Q171.5 96 212 96q37 0 70 8 26.25-20.5 46.75-30.25T376 64q12.75 25.5 12.75 54.5 0 21.75-6.75 42 34 40 34 99.5z"/></svg>
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="__drawer"></label>
    
      <a href="#configuration" tabindex="0" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="../.." title="Kelon Docs" aria-label="Kelon Docs" class="md-header-nav__button md-logo">
          
            <i class="md-icon"></i>
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="__drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            <span class="md-header-nav__topic">
              Kelon Docs
            </span>
            <span class="md-header-nav__topic">
              
                Configuration
              
            </span>
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="__search"></label>
          
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" aria-label="search" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="__search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  

<a href="https://github.com/foundato/kelon/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    foundato/kelon
  </div>
</a>
          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      
      <main class="md-main" role="main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="__drawer">
    <a href="../.." title="Kelon Docs" class="md-nav__button md-logo">
      
        <i class="md-icon"></i>
      
    </a>
    Kelon Docs
  </label>
  
    <div class="md-nav__source">
      


  

<a href="https://github.com/foundato/kelon/" title="Go to repository" class="md-source" data-md-source="github">
  
    <div class="md-source__icon">
      <svg viewBox="0 0 24 24" width="24" height="24">
        <use xlink:href="#__github" width="24" height="24"></use>
      </svg>
    </div>
  
  <div class="md-source__repository">
    foundato/kelon
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1" type="checkbox" id="nav-1">
    
    <label class="md-nav__link" for="nav-1">
      Core Docs
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-1">
        Core Docs
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../.." title="Introduction" class="md-nav__link">
      Introduction
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-2" type="checkbox" id="nav-1-2">
    
    <label class="md-nav__link" for="nav-1-2">
      Overview
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-2">
        Overview
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../core/overview/Simple-Example/" title="Example" class="md-nav__link">
      Example
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../core/overview/example/Create-Policies/" title="Create Policies" class="md-nav__link">
      Create Policies
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../core/overview/example/Configure-Kelon/" title="Configure Kelon" class="md-nav__link">
      Configure Kelon
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../core/overview/example/Run-Example/" title="Run the example" class="md-nav__link">
      Run the example
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-3" type="checkbox" id="nav-1-3">
    
    <label class="md-nav__link" for="nav-1-3">
      Philosophy
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-3">
        Philosophy
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../core/philosophy/Why-External-Policy-Enforcement/" title="Why external Policy Enforcement" class="md-nav__link">
      Why external Policy Enforcement
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../core/philosophy/What-Is-A-Policy/" title="What is a Policy" class="md-nav__link">
      What is a Policy
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-4" type="checkbox" id="nav-1-4">
    
    <label class="md-nav__link" for="nav-1-4">
      Architecture
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-4">
        Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../core/architecture/Components/" title="Components" class="md-nav__link">
      Components
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../core/architecture/Policy-Translation/" title="Policy Translation" class="md-nav__link">
      Policy Translation
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../core/architecture/Query-AST/" title="Query-AST" class="md-nav__link">
      Query-AST
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-5" type="checkbox" id="nav-1-5">
    
    <label class="md-nav__link" for="nav-1-5">
      Integrating Kelon
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-5">
        Integrating Kelon
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../core/integration/Services-And-Kelon/" title="Services and Kelon" class="md-nav__link">
      Services and Kelon
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../core/integration/Kelon-Gloo/" title="Kelon and Gloo" class="md-nav__link">
      Kelon and Gloo
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../core/integration/Kelon-Istio/" title="Kelon and Istio" class="md-nav__link">
      Kelon and Istio
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-1-6" type="checkbox" id="nav-1-6">
    
    <label class="md-nav__link" for="nav-1-6">
      Extending Kelon
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="2">
      <label class="md-nav__title" for="nav-1-6">
        Extending Kelon
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../core/extend/Write-Plugins/" title="Writing plugins" class="md-nav__link">
      Writing plugins
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../core/extend/Write-Datastore-Plugin/" title="Write a datasource plugin" class="md-nav__link">
      Write a datasource plugin
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-toggle md-nav__toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2" checked>
    
    <label class="md-nav__link" for="nav-2">
      Operations
    </label>
    <nav class="md-nav" data-md-component="collapsible" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        Operations
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../APIs/" title="APIs" class="md-nav__link">
      APIs
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Configuration
      </label>
    
    <a href="./" title="Configuration" class="md-nav__link md-nav__link--active">
      Configuration
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#kelon-cli" class="md-nav__link">
    Kelon (CLI)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general" class="md-nav__link">
    General
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#envoy" class="md-nav__link">
    Envoy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#istio" class="md-nav__link">
    Istio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#telemetry" class="md-nav__link">
    Telemetry
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#application-insights" class="md-nav__link">
    Application Insights
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datastoreyml" class="md-nav__link">
    datastore.yml
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connection-options" class="md-nav__link">
    Connection options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#injecting-environment-variables" class="md-nav__link">
    Injecting environment variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#call-operandsdatastore-typeyml" class="md-nav__link">
    call-operands/{datastore-type}.yml
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apiyml" class="md-nav__link">
    api.yml
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opayml" class="md-nav__link">
    opa.yml
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Deployment/" title="Deployment" class="md-nav__link">
      Deployment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Monitoring/" title="Monitoring" class="md-nav__link">
      Monitoring
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../Security/" title="Security" class="md-nav__link">
      Security
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#kelon-cli" class="md-nav__link">
    Kelon (CLI)
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#general" class="md-nav__link">
    General
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#envoy" class="md-nav__link">
    Envoy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#istio" class="md-nav__link">
    Istio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#telemetry" class="md-nav__link">
    Telemetry
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#application-insights" class="md-nav__link">
    Application Insights
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#datastoreyml" class="md-nav__link">
    datastore.yml
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#connection-options" class="md-nav__link">
    Connection options
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#injecting-environment-variables" class="md-nav__link">
    Injecting environment variables
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#call-operandsdatastore-typeyml" class="md-nav__link">
    call-operands/{datastore-type}.yml
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#apiyml" class="md-nav__link">
    api.yml
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#opayml" class="md-nav__link">
    opa.yml
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/foundato/kelon/edit/master/docs/operations/Configuration.md" title="Edit this page" class="md-icon md-content__icon">&#xE3C9;</a>
                
                
                <h1 id="configuration">Configuration</h1>
<h2 id="kelon-cli">Kelon (CLI)</h2>
<p>Kelon already comes with a CLI. Just type <code>kelon --help</code> after you installed it.
<div class="highlight"><pre><span></span><code>usage: kelon [&lt;flags&gt;] &lt;command&gt; [&lt;args&gt; ...]

Kelon policy enforcer.

Flags:
  -h, --help                   Show context-sensitive help (also try --help-long and --help-man).
  -d, --datastore-conf=./datastore.yml  
                               Path to the datastore configuration yaml.
  -a, --api-conf=./api.yml     Path to the api configuration yaml.
      --config-watcher-path=CONFIG-WATCHER-PATH  
                               Path where the config watcher should listen for changes.
  -o, --opa-conf=./opa.yml     Path to the OPA configuration yaml.
  -r, --rego-dir=REGO-DIR      Dir containing .rego files which will be loaded into OPA.
      --path-prefix=&quot;/v1&quot;      Prefix which is used to proxy OPA&#39;s Data-API.
  -p, --port=8181              Port on which the proxy endpoint is served.
      --preprocess-policies    Preprocess incoming policies for internal use-case (EXPERIMENTAL FEATURE! DO NOT USE!).
      --log-level=INFO         Log-Level for Kelon. Must be one of [DEBUG, INFO, WARN, ERROR]
      --respond-with-status-code  
                               Communicate Decision via status code 200 (ALLOW) or 403 (DENY).
      --envoy-port=ENVOY-PORT  Also start Envoy GRPC-Proxy on specified port so integrate kelon with Istio.
      --envoy-dry-run          Enable/Disable the dry run feature of the envoy-proxy.
      --envoy-reflection       Enable/Disable the reflection feature of the envoy-proxy.
      --istio-port=ISTIO-PORT  Also start Istio Mixer Out of Tree Adapter on specified port so integrate kelon with Istio.
      --istio-credential-file=ISTIO-CREDENTIAL-FILE  
                               Filepath containing istio credentials for mTLS (i.e. adapter.crt).
      --istio-private-key-file=ISTIO-PRIVATE-KEY-FILE  
                               Filepath containing istio private key for mTLS (i.e. adapter.key).
      --istio-certificate-file=ISTIO-CERTIFICATE-FILE  
                               Filepath containing istio certificate for mTLS (i.e. ca.pem).
      --telemetry-service=TELEMETRY-SERVICE  
                               Service that is used for telemetry [Prometheus, ApplicationInsights]
      --instrumentation-key=INSTRUMENTATION-KEY  
                               The ApplicationInsights-InstrumentationKey that is used to connect to the API.
      --application-insights-service-name=&quot;Kelon&quot;  
                               The name which will be displayed for kelon inside application insights.
      --application-insights-max-batch-size=8192  
                               Configure how many items can be sent in one call to the data collector.
      --application-insights-max-batch-interval-seconds=2  
                               Configure the maximum delay before sending queued telemetry.
      --application-insights-log-levels=&quot;fatal,panic,error,warn&quot;  
                               Configure log levels which are sent. Allowed values are [fatal, panic, error, warn, info, debug, trace]
      --application-insights-stats-interval-seconds=5  
                               Interval in seconds in which system stats are measured and sent.
      --version                Show application version.

Commands:
  help [&lt;command&gt;...]
    Show help.

  run
    Run kelon in production mode.
</code></pre></div></p>
<p>In addition to that Kelon provides the possibility to be configured via environment variables. This may be handy if you want to run it inside a container.</p>
<h3 id="general">General</h3>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Short</th>
<th>Environment</th>
<th>Default</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>--datastore-conf</td>
<td>-d</td>
<td>DATASTORE_CONF</td>
<td>./datastore.yml</td>
<td>Existing File</td>
</tr>
<tr>
<td>--api-conf</td>
<td>-a</td>
<td>API_CONF</td>
<td>./api.yml</td>
<td>Existing File</td>
</tr>
<tr>
<td>--config-watcher-path</td>
<td></td>
<td>CONFIG_WATCHER_PATH</td>
<td>./policies</td>
<td>Existing Dir</td>
</tr>
<tr>
<td>--opa-conf</td>
<td>-o</td>
<td>OPA_CONF</td>
<td>./opa.yml</td>
<td>Existing File</td>
</tr>
<tr>
<td>--rego-dir</td>
<td>-r</td>
<td>REGO_DIR</td>
<td>./policies</td>
<td>Existing Dir</td>
</tr>
<tr>
<td>--path-prefix</td>
<td></td>
<td>PATH_PREFIX</td>
<td>/v1</td>
<td>String</td>
</tr>
<tr>
<td>--port</td>
<td>-p</td>
<td>PORT</td>
<td>8181</td>
<td>Number</td>
</tr>
<tr>
<td>--preprocess-policies</td>
<td></td>
<td>PREPROCESS_POLICIES</td>
<td>false</td>
<td>Boolean</td>
</tr>
<tr>
<td>--respond-with-status-code</td>
<td></td>
<td>RESPOND_WITH_STATUS_CODE</td>
<td>false</td>
<td>Boolean</td>
</tr>
</tbody>
</table>
<h3 id="envoy">Envoy</h3>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Short</th>
<th>Environment</th>
<th>Default</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>--envoy-port</td>
<td></td>
<td>ENVOY_PORT</td>
<td></td>
<td>Number</td>
</tr>
<tr>
<td>--envoy-dry-run</td>
<td></td>
<td>ENVOY_DRY_RUN</td>
<td>false</td>
<td>Boolean</td>
</tr>
<tr>
<td>--envoy-reflection</td>
<td></td>
<td>ENVOY_REFLECTION</td>
<td>false</td>
<td>Boolean</td>
</tr>
</tbody>
</table>
<h3 id="istio">Istio</h3>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Short</th>
<th>Environment</th>
<th>Default</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>--istio-port</td>
<td></td>
<td>ISTIO_PORT</td>
<td></td>
<td>Number</td>
</tr>
<tr>
<td>--istio-credential-file</td>
<td></td>
<td>ISTIO_CREDENTIAL_FILE</td>
<td></td>
<td>Existing File</td>
</tr>
<tr>
<td>--istio-private-key-file</td>
<td></td>
<td>ISTIO_PRIVATE_KEY_FILE</td>
<td></td>
<td>Existing File</td>
</tr>
<tr>
<td>--istio-certificate-file</td>
<td></td>
<td>ISTIO_CERTIFICATE_FILE</td>
<td></td>
<td>Existing File</td>
</tr>
</tbody>
</table>
<h3 id="telemetry">Telemetry</h3>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Short</th>
<th>Environment</th>
<th>Default</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>--telemetry-service</td>
<td></td>
<td>TELEMETRY_SERVICE</td>
<td></td>
<td>Enum</td>
</tr>
</tbody>
</table>
<h4 id="application-insights">Application Insights</h4>
<p>When you have set <code>ApplicationInsights</code> as --telemetry-service</p>
<table>
<thead>
<tr>
<th>Flag</th>
<th>Short</th>
<th>Environment</th>
<th>Default</th>
<th>Type</th>
</tr>
</thead>
<tbody>
<tr>
<td>--instrumentation-key</td>
<td></td>
<td>INSTRUMENTATION_KEY</td>
<td></td>
<td>String</td>
</tr>
<tr>
<td>--application-insights-service-name</td>
<td></td>
<td>APPLICATION_INSIGHTS_SERVICE_NAME</td>
<td>Kelon</td>
<td>String</td>
</tr>
<tr>
<td>--application-insights-max-batch-size</td>
<td></td>
<td>APPLICATION_INSIGHTS_MAX_BATCH_SIZE</td>
<td>8192</td>
<td>Number</td>
</tr>
<tr>
<td>--application-insights-max-batch-interval-seconds</td>
<td></td>
<td>APPLICATION_INSIGHTS_MAX_BATCH_INTERVAL_SECONDS</td>
<td>2</td>
<td>Number</td>
</tr>
<tr>
<td>--application-insights-log-levels</td>
<td></td>
<td>APPLICATION_INSIGHTS_LOG_LEVELS</td>
<td>fatal,panic,error,warn</td>
<td>Enum-List</td>
</tr>
<tr>
<td>--application-insights-stats-interval-seconds</td>
<td></td>
<td>APPLICATION_INSIGHTS_STATS_INTERVAL_SECONDS</td>
<td>5</td>
<td>Number</td>
</tr>
</tbody>
</table>
<h2 id="datastoreyml">datastore.yml</h2>
<p>The <code>datastore.yml</code> defines all available datastores and their entities.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># List of all datastores which kelon should be able to connect to</span>
<span class="c1"># Each datastore has to have an entity schema configured!</span>
<span class="nt">datastores</span><span class="p">:</span>

  <span class="c1"># Datastore&#39;s alias (it will be used throughout all your policies).</span>
  <span class="nt">mysql</span><span class="p">:</span>

    <span class="c1"># Datastore type</span>
    <span class="c1"># Kelon supports [mysql, postgres, mongo]</span>
    <span class="p p-Indicator">[</span><span class="nv">type</span><span class="p p-Indicator">:</span> <span class="nv">&lt;string&gt;</span><span class="p p-Indicator">]</span>

    <span class="c1"># Properties that are needed to connect to the datastore</span>
    <span class="nt">connection</span><span class="p">:</span>     

      <span class="c1"># Hostname or IP of the database</span>
      <span class="p p-Indicator">[</span><span class="nv">host</span><span class="p p-Indicator">:</span> <span class="nv">&lt;string&gt;</span><span class="p p-Indicator">]</span>

      <span class="c1"># Port under which the database is available</span>
      <span class="p p-Indicator">[</span><span class="nv">port</span><span class="p p-Indicator">:</span> <span class="nv">&lt;int&gt;</span><span class="p p-Indicator">]</span>

      <span class="c1"># Name of the database to connect to</span>
      <span class="c1"># Many database servers run multiple databases.</span>
      <span class="c1"># In this case create one datastore for each database</span>
      <span class="p p-Indicator">[</span><span class="nv">database</span><span class="p p-Indicator">:</span> <span class="nv">&lt;string&gt;</span><span class="p p-Indicator">]</span>

      <span class="c1"># The user which is used for the database connection</span>
      <span class="p p-Indicator">[</span><span class="nv">user</span><span class="p p-Indicator">:</span> <span class="nv">&lt;string&gt;</span><span class="p p-Indicator">]</span>

      <span class="c1"># The password of the user</span>
      <span class="p p-Indicator">[</span><span class="nv">password</span><span class="p p-Indicator">:</span> <span class="nv">&lt;string&gt;</span><span class="p p-Indicator">]</span>

      <span class="c1"># Connection options for the database connection</span>
      <span class="c1"># To get all available options for your database, see section &quot;Connection options&quot; below</span>
      <span class="p p-Indicator">[</span><span class="nv">&lt;option&gt;</span><span class="p p-Indicator">:</span> <span class="nv">&lt;string&gt;</span><span class="p p-Indicator">]</span>

    <span class="c1"># Metadata attached to the datastore</span>
    <span class="nt">metadata</span><span class="p">:</span>

      <span class="c1"># Only used from SQL-Datastores</span>
      <span class="c1"># Sets max idle connections of the database connection pool</span>

      <span class="p p-Indicator">[</span><span class="nv">maxIdleConnections</span><span class="p p-Indicator">:</span> <span class="nv">&lt;int&gt;</span><span class="p p-Indicator">]</span>

      <span class="c1"># Only used from SQL-Datastores</span>
      <span class="c1"># Sets max open connections of the database connection pool</span>
      <span class="p p-Indicator">[</span><span class="nv">maxOpenConnections</span><span class="p p-Indicator">:</span> <span class="nv">&lt;int&gt;</span><span class="p p-Indicator">]</span>

      <span class="c1"># Only used from SQL-Datastores</span>
      <span class="c1"># Sets max lifetime of each connection inside the database connection pool</span>
      <span class="p p-Indicator">[</span><span class="nv">connectionMaxLifetimeSeconds</span><span class="p p-Indicator">:</span> <span class="nv">&lt;int&gt;</span><span class="p p-Indicator">]</span>

      <span class="c1"># Only used if ApplicationInsights is set as Telemetry-Service!</span>
      <span class="c1"># Sets the name of the Dependency which is traced for this datastore</span>
      <span class="p p-Indicator">[</span><span class="nv">telemetryName</span><span class="p p-Indicator">:</span> <span class="nv">&lt;string&gt;</span><span class="p p-Indicator">]</span>

      <span class="c1"># Only used if ApplicationInsights is set as Telemetry-Service!</span>
      <span class="c1"># Sets the type of the Dependency which is traced for this datastore</span>
      <span class="p p-Indicator">[</span><span class="nv">telemetryType</span><span class="p p-Indicator">:</span> <span class="nv">&lt;string&gt;</span><span class="p p-Indicator">]</span>


<span class="c1"># Entity-Schemas define the entities of one schema inside a datastore.</span>
<span class="c1"># An entity_schema has several purposes:</span>
<span class="c1">#   =&gt; Help kelon to detect misspellings in regos</span>
<span class="c1">#   =&gt; Create entity-aliases for complex table-names</span>
<span class="c1">#   =&gt; Define the structure of nested entities (Just for No-SQL DBs)</span>
<span class="nt">entity_schemas</span><span class="p">:</span>

  <span class="c1"># Datastore&#39;s alias</span>
  <span class="c1"># This example shows how each SQL-Datastore should be configured.</span>
  <span class="nt">mysql</span><span class="p">:</span>

    <span class="c1"># Schema name</span>
    <span class="c1"># Kelon automatically adds the schema name to entities</span>
    <span class="c1"># This means that &#39;data.mysql.users&#39; inside a rego will be translated </span>
    <span class="c1"># to &#39;appstore.users&#39; in the resulting SQL-Statement.</span>
    <span class="c1">#</span>
    <span class="c1"># !!! The entities inside all schemas of one Datastore have to be disjunct !!!</span>
    <span class="c1"># Otherwise kelon will fail on startup</span>
    <span class="nt">appstore</span><span class="p">:</span>

      <span class="c1"># List of all entities of schema &#39;appstore&#39;</span>
      <span class="nt">entities</span><span class="p">:</span>

        <span class="c1"># Entity with the name inside the datastore</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">name</span><span class="p p-Indicator">:</span> <span class="nv">&lt;string&gt;</span><span class="p p-Indicator">]</span>

          <span class="c1"># And an optional alias (used inside regos)</span>
          <span class="p p-Indicator">[</span><span class="nv">alias</span><span class="p p-Indicator">:</span> <span class="nv">&lt;string&gt; | optional</span><span class="p p-Indicator">]</span>


  <span class="c1"># This example shows how each No-SQL-Datastore should be configured.</span>
  <span class="nt">mongo</span><span class="p">:</span>

    <span class="c1"># Schema name</span>
    <span class="c1"># Because No-SQL-Datastores don&#39;t have concept for schemas, </span>
    <span class="c1"># Kelon ignores the schema name for i.e. a MongoDB.</span>
    <span class="c1">#</span>
    <span class="c1"># !!! The entities inside all schemas of one Datastore have to be disjunct !!!</span>
    <span class="c1"># Otherwise kelon will fail on startup</span>
    <span class="nt">appstore</span><span class="p">:</span>

      <span class="c1"># List of all entities (in case of MongoDB each entity is a collection)</span>
      <span class="nt">entities</span><span class="p">:</span>

        <span class="c1"># Collection with it&#39;s name inside the datastore</span>
        <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">name</span><span class="p p-Indicator">:</span> <span class="nv">&lt;string&gt;</span><span class="p p-Indicator">]</span>

          <span class="c1"># Collection&#39;s optinal alias (used inside regos)</span>
          <span class="p p-Indicator">[</span><span class="nv">alias</span><span class="p p-Indicator">:</span> <span class="nv">&lt;string&gt; | optional</span><span class="p p-Indicator">]</span>

          <span class="c1"># Nested entities (Only supported for No-SQL-Datastores)</span>
          <span class="c1"># The depth of nesting entities is unlimited.</span>
          <span class="c1"># It makes no difference if the nested entities are arrays or objects</span>
          <span class="nt">entities</span><span class="p">:</span>

            <span class="c1"># Name of nested entity</span>
            <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">name</span><span class="p p-Indicator">:</span> <span class="nv">&lt;string&gt;</span><span class="p p-Indicator">]</span>
              <span class="c1"># Collection&#39;s optinal alias (used inside regos)</span>
              <span class="p p-Indicator">[</span><span class="nv">alias</span><span class="p p-Indicator">:</span> <span class="nv">&lt;string&gt; | optional</span><span class="p p-Indicator">]</span>
</code></pre></div>

<h3 id="connection-options">Connection options</h3>
<p>Kelon supports different databases (PostgreSQL, MySQL and MongoDB) each of them having different connection options.
To keep the configuration of connection options as simple as possible, Kelon just passes all key-value-pairs of each the datastore connection (despite the dedicated ones like i.e. username, host, port, etc.) directly to the used database adapter. Following table should help to lookup all available options for each supported database:</p>
<table>
<thead>
<tr>
<th>Database</th>
<th>Used driver</th>
<th>Options</th>
</tr>
</thead>
<tbody>
<tr>
<td>PostgreSQL</td>
<td>github.com/lib/pq</td>
<td><a href="https://godoc.org/github.com/lib/pq#hdr-Connection_String_Parameters">Go Docs, Connection String Parameters</a></td>
</tr>
<tr>
<td>MySQL</td>
<td>github.com/go-sql-driver/mysql</td>
<td><a href="https://github.com/go-sql-driver/mysql#parameters">Go Docs, DSN Parameters</a></td>
</tr>
<tr>
<td>MongoDB</td>
<td>go.mongodb.org/mongo-driver/mongo</td>
<td><a href="https://docs.mongodb.com/manual/reference/connection-string/#connections-connection-options">Mongo-Docs, Connection options</a></td>
</tr>
</tbody>
</table>
<h3 id="injecting-environment-variables">Injecting environment variables</h3>
<p>Each value inside the datastore.yml file can be replaced with a string follwing the pattern <code>${&lt;environment variable&gt;}</code> which is replaced with the value of the environment variable at startup. </p>
<h2 id="call-operandsdatastore-typeyml">call-operands/{datastore-type}.yml</h2>
<p>Open Policy Agent has <a href="https://www.openpolicyagent.org/docs/latest/policy-language/#operators">builtin call operands</a> which may not be the same as the ones of each datastore.
Therefore each datastore-type has to have a mapping-file inside the folder 'call-operands'. The name of each file inside this directory has to match the type of the datastore.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Call operands map OPA&#39;s functions to datastore-native ones.</span>
<span class="c1"># You find more advanced files in directory /call-operands</span>
<span class="nt">call-operands</span><span class="p">:</span>

  <span class="c1"># Operand name inside OPA&#39;s context</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">op</span><span class="p p-Indicator">:</span> <span class="nv">&lt;string&gt;</span><span class="p p-Indicator">]</span>

    <span class="c1"># Number of arguments the function call should take</span>
    <span class="c1"># Used for validation</span>
    <span class="p p-Indicator">[</span><span class="nv">args</span><span class="p p-Indicator">:</span> <span class="nv">&lt;int&gt;</span><span class="p p-Indicator">]</span>

    <span class="c1"># Mapping which mappes the OPA-native call to a Datastore-native call.</span>
    <span class="c1"># This is done by defining a pattern where all occurences of $&lt;arg-pos&gt;</span>
    <span class="c1"># are replaced with the original argument at position &lt;arg-pos&gt; (zero based).</span>
    <span class="p p-Indicator">[</span><span class="nv">mapping</span><span class="p p-Indicator">:</span> <span class="nv">&lt;string&gt;</span><span class="p p-Indicator">]</span>
</code></pre></div>

<h2 id="apiyml">api.yml</h2>
<p>The <code>datastore.yml</code> contains all necessary configuration kelon needs to map incoming api-requests to OPA-Queries executed inside datastores.</p>
<div class="highlight"><pre><span></span><code><span class="c1"># Mappings for the APIs that your services expose</span>
<span class="nt">apis</span><span class="p">:</span>

  <span class="c1"># API-Collection</span>
  <span class="c1"># Each collection can have a path prefix which is prepended to every API-Mapping</span>
  <span class="c1"># inside the collection.</span>
  <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">path-prefix</span><span class="p p-Indicator">:</span> <span class="nv">&lt;URL|string&gt;</span><span class="p p-Indicator">]</span>

    <span class="c1"># All rego-queries mapped by this API-collection will include </span>
    <span class="c1"># this datastore-alias as unknown.</span>
    <span class="c1"># This means that the regos this collection targets can contain</span>
    <span class="c1"># something like &#39;data.&lt;datastore-alias&gt;.&lt;entity&gt;.&lt;attribute&gt;&#39;</span>
    <span class="p p-Indicator">[</span><span class="nv">datastore</span><span class="p p-Indicator">:</span> <span class="nv">&lt;datastore-alias|string&gt;</span><span class="p p-Indicator">]</span>

    <span class="c1"># Path-Mappings for incoming paths</span>
    <span class="c1"># (the most specific mapping is picked in case of multiple mappings)</span>
    <span class="nt">mappings</span><span class="p">:</span>

      <span class="c1"># Path-Mapping</span>
      <span class="c1"># Each mapping has to specify a path (regex) and a package which is used</span>
      <span class="c1"># by kelon to generate the target package of an mapped query.</span>
      <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">path</span><span class="p p-Indicator">:</span> <span class="nv">&lt;regex|string&gt;</span><span class="p p-Indicator">]</span> 

        <span class="c1"># OPA&#39;s target package of this Path-Mapping</span>
        <span class="p p-Indicator">[</span><span class="nv">package</span><span class="p p-Indicator">:</span> <span class="nv">&lt;string&gt;</span><span class="p p-Indicator">]</span>

        <span class="c1"># HTTP-Methods this path should map (optional)</span>
        <span class="c1"># If no methods are specified, kellon will match [GET,PUT,POST,DELETE,PATCH]</span>
        <span class="nt">methods</span><span class="p">:</span>
          <span class="p p-Indicator">-</span> <span class="p p-Indicator">[</span><span class="nv">&lt;string&gt; ...</span><span class="p p-Indicator">]</span>
</code></pre></div>

<h2 id="opayml">opa.yml</h2>
<p>Internally used by Open Policy Agent. Klick <a href="https://www.openpolicyagent.org/docs/latest/configuration/">here</a> for more information.</p>
<div class="highlight"><pre><span></span><code><span class="nt">labels</span><span class="p">:</span>
  <span class="nt">app</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">Kelon</span>
  <span class="nt">region</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">europe-west3</span>
  <span class="nt">environment</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">development</span>

<span class="nt">decision_logs</span><span class="p">:</span>
  <span class="nt">console</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">true</span>
  <span class="nt">reporting</span><span class="p">:</span>
    <span class="nt">min_delay_seconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">300</span>
    <span class="nt">max_delay_seconds</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">600</span>

<span class="nt">default_decision</span><span class="p">:</span> <span class="l l-Scalar l-Scalar-Plain">/http/authz/allow</span>
</code></pre></div>
                
                  
                
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../APIs/" title="APIs" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                APIs
              </span>
            </div>
          </a>
        
        
          <a href="../Deployment/" title="Deployment" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Deployment
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        powered by
        <a href="https://www.mkdocs.org" target="_blank" rel="noopener">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs</a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/application.c33a9706.js"></script>
      
      <script>app.initialize({version:"1.0.4",url:{base:"../.."}})</script>
      
    
  </body>
</html>